<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Honeypot Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            color: #fff;
            min-height: 100vh;
        }
        .header {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        .header h1 { color: #00ff88; font-size: 28px; }
        .header p { color: #888; margin-top: 5px; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .stat-card h3 { color: #888; font-size: 14px; margin-bottom: 10px; }
        .stat-card .value { font-size: 36px; font-weight: bold; color: #00ff88; }
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
        }
        .chart-card h3 { color: #fff; margin-bottom: 15px; font-size: 16px; }
        .log-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
        }
        .log-section h3 { color: #fff; margin-bottom: 15px; }
        .log-list { max-height: 400px; overflow-y: auto; }
        .log-item {
            background: rgba(0,0,0,0.3);
            border-left: 3px solid #00ff88;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 0 5px 5px 0;
            font-family: monospace;
            font-size: 13px;
        }
        .log-item.http { border-left-color: #00aaff; }
        .log-item.telnet { border-left-color: #ffaa00; }
        .log-item.ssh { border-left-color: #ff5555; }
        .log-item .time { color: #666; margin-right: 10px; }
        .log-item .type { color: #00ff88; font-weight: bold; margin-right: 10px; }
        .log-item .ip { color: #ff8800; margin-right: 10px; }
        .log-item .payload { color: #aaa; }
        .status-indicator {
            display: inline-block;
            width: 10px; height: 10px;
            background: #00ff88;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .top-list { list-style: none; }
        .top-list li {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .top-list li:last-child { border-bottom: none; }
        .top-list .count {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ°Ô∏è IoT Honeypot Dashboard</h1>
        <p><span class="status-indicator"></span>Real-time Threat Monitoring - SENG 484</p>
    </div>
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Events</h3>
                <div class="value" id="total-events">0</div>
            </div>
            <div class="stat-card">
                <h3>Unique IPs</h3>
                <div class="value" id="unique-ips">0</div>
            </div>
            <div class="stat-card">
                <h3>Login Attempts</h3>
                <div class="value" id="login-attempts">0</div>
            </div>
            <div class="stat-card">
                <h3>Scans Detected</h3>
                <div class="value" id="scans-detected">0</div>
            </div>
        </div>
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìä Attack Types</h3>
                <canvas id="eventTypeChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>üåç Top Attacking IPs</h3>
                <ul class="top-list" id="top-ips-list"></ul>
            </div>
            <div class="chart-card">
                <h3>üîë Top Credentials</h3>
                <ul class="top-list" id="top-creds-list"></ul>
            </div>
            <div class="chart-card">
                <h3>üìà 24-Hour Activity</h3>
                <canvas id="hourlyChart"></canvas>
            </div>
        </div>
        <div class="log-section">
            <h3>üìú Live Event Stream</h3>
            <div class="log-list" id="log-list"></div>
        </div>
    </div>
    <script>
        const socket = io();
        let eventTypeChart, hourlyChart;
        
        function initCharts() {
            const ctx1 = document.getElementById('eventTypeChart').getContext('2d');
            eventTypeChart = new Chart(ctx1, {
                type: 'doughnut',
                data: { labels: [], datasets: [{ data: [], backgroundColor: ['#00ff88', '#00aaff', '#ffaa00', '#ff5555', '#aa55ff', '#55ffaa'] }] },
                options: { responsive: true, plugins: { legend: { labels: { color: '#fff' } } } }
            });
            
            const ctx2 = document.getElementById('hourlyChart').getContext('2d');
            hourlyChart = new Chart(ctx2, {
                type: 'bar',
                data: { labels: Array.from({length: 24}, (_, i) => i + ':00'), datasets: [{ label: 'Events', data: Array(24).fill(0), backgroundColor: '#00ff88' }] },
                options: { responsive: true, scales: { y: { beginAtZero: true, ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } } }, plugins: { legend: { display: false } } }
            });
        }
        
        function updateStats(stats) {
            document.getElementById('total-events').textContent = stats.total_events || 0;
            document.getElementById('unique-ips').textContent = stats.unique_ips || 0;
            const loginAttempts = (stats.event_types?.HTTP_LOGIN || 0) + (stats.event_types?.TELNET_LOGIN || 0);
            document.getElementById('login-attempts').textContent = loginAttempts;
            document.getElementById('scans-detected').textContent = stats.event_types?.HTTP_SCAN || 0;
            
            if (stats.event_types) {
                eventTypeChart.data.labels = Object.keys(stats.event_types);
                eventTypeChart.data.datasets[0].data = Object.values(stats.event_types);
                eventTypeChart.update();
            }
            
            if (stats.hourly_activity) {
                const hourlyData = Array(24).fill(0);
                Object.entries(stats.hourly_activity).forEach(([hour, count]) => { hourlyData[parseInt(hour)] = count; });
                hourlyChart.data.datasets[0].data = hourlyData;
                hourlyChart.update();
            }
            
            const ipsList = document.getElementById('top-ips-list');
            ipsList.innerHTML = '';
            (stats.top_ips || []).forEach(item => { ipsList.innerHTML += `<li><span>${item.ip}</span><span class="count">${item.count}</span></li>`; });
            
            const credsList = document.getElementById('top-creds-list');
            credsList.innerHTML = '';
            (stats.top_credentials || []).slice(0, 10).forEach(item => {
                const payload = item.payload.replace(/username=|password=/g, '').replace('&', ' / ');
                credsList.innerHTML += `<li><span style="font-family:monospace;font-size:12px">${payload}</span><span class="count">${item.count}</span></li>`;
            });
        }
        
        function addLogItem(log) {
            const logList = document.getElementById('log-list');
            const logType = (log.type || '').toLowerCase();
            let typeClass = logType.includes('http') ? 'http' : logType.includes('telnet') ? 'telnet' : logType.includes('ssh') ? 'ssh' : '';
            
            const logItem = document.createElement('div');
            logItem.className = `log-item ${typeClass}`;
            logItem.innerHTML = `<span class="time">${log.timestamp || new Date().toISOString()}</span><span class="type">${log.type}</span><span class="ip">${log.source_ip}</span><span class="payload">${log.payload}</span>`;
            logList.insertBefore(logItem, logList.firstChild);
            while (logList.children.length > 100) logList.removeChild(logList.lastChild);
        }
        
        socket.on('connect', () => console.log('Connected'));
        socket.on('stats_update', updateStats);
        socket.on('new_log', (log) => { addLogItem(log); socket.emit('request_stats'); });
        
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            fetch('/api/stats').then(r => r.json()).then(updateStats);
            fetch('/api/logs?limit=50').then(r => r.json()).then(logs => logs.reverse().forEach(addLogItem));
            setInterval(() => socket.emit('request_stats'), 5000);
        });
    </script>
</body>
</html>
